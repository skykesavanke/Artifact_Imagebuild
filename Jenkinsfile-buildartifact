pipeline{
    agent {
        docker{image 'maven:3.8.2-amazoncorretto-17'
         //args '-v /c/Users/kesavank/ArtifactBuild:/src'
         }
    }
    

    environment{
         AWS_ACCESS_KEY_ID     = credentials('aws-access-key-id')
         AWS_SECRET_ACCESS_KEY = credentials('aws-secret-access-key')
         ARTIFACT_REPO = "buildartifactrepo"
         REGION = "us-east-1"
         
    }
    
    stages{
        stage('Code Checkout'){
             steps{
                script{
                git branch:'master',url:'https://github.com/skykesavanke/Artifact_Imagebuild.git'
            }
             }

            }
        stage('Building Artifact'){
            steps{
            
                dir('/src/') {

                bat 'mvn clean'
                echo ".......Cleaning the previous build......"
                bat 'mvn compile'
                echo ".......Compiling the source code......"
                bat 'mvn package'
                echo ".......Creating Jar files........"
                bat 'mv target/*.jar target/hello-artifact.jar'
                
            }
            }
        }
        stage('Push to Code Artifact'){
            steps{
                script{
                  
                def domainName = 'buildartifact'
                def repositoryName = "${env.ARTIFACT_REPO}"
                def artifactPath = 'target/hello-artifact.jar'
                def region ="${env.REGION}"

                bat """
                    set ARTIFACT_REPO=${repositoryName}
                    set REGION=${region}
                   
                   aws codeartifact upload-package \
                        --domain $domainName \
                        --repository %ARTIFACT_REPO% \
                        --package format=maven \
                         --path $artifactPath
                          --region %REGION%
                """
             
                }        


            }
        }
        }
    }


